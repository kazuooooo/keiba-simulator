!function(t){var e=0,i=function(){return(new Date).getTime()+e++},n=function(t){return"["+t+"]$1"},o=function(t){return"_"+t+"_$1"},s=function(e,i,n){return e?"function"==typeof e?(i&&console.warn("association-insertion-traversal is ignored, because association-insertion-node is given as a function."),e(n)):"string"==typeof e?i?n[i](e):"this"==e?n:t(e):void 0:n.parent()};t(document).on("click",".add_fields",function(e){console.log("load cocoon.js");e.preventDefault();var r=t(this),a=r.data("association"),l=r.data("associations"),h=r.data("association-insertion-template"),c=r.data("association-insertion-method")||r.data("association-insertion-position")||"before",d=r.data("association-insertion-node"),p=r.data("association-insertion-traversal"),u=parseInt(r.data("count"),10),g=new RegExp("\\[new_"+a+"\\](.*?\\s)","g"),f=new RegExp("_new_"+a+"_(\\w*)","g"),m=i(),y=h.replace(g,n(m)),x=[];for(y==h&&(g=new RegExp("\\[new_"+l+"\\](.*?\\s)","g"),f=new RegExp("_new_"+l+"_(\\w*)","g"),y=h.replace(g,n(m))),y=y.replace(f,o(m)),x=[y],u=isNaN(u)?1:Math.max(u,1),u-=1;u;)m=i(),y=h.replace(g,n(m)),y=y.replace(f,o(m)),x.push(y),u-=1;var v=s(d,p,r);v&&0!=v.length||console.warn("Couldn't find the element to insert the template. Make sure your `data-association-insertion-*` on `link_to_add_association` is correct."),t.each(x,function(e,i){var n=t(i);v.trigger("cocoon:before-insert",[n]);v[c](n);v.trigger("cocoon:after-insert",[n])})}),t(document).on("click",".remove_fields.dynamic, .remove_fields.existing",function(e){var i=t(this),n=i.data("wrapper-class")||"nested-fields",o=i.closest("."+n),s=o.parent();e.preventDefault(),s.trigger("cocoon:before-remove",[o]);var r=s.data("remove-timeout")||0;setTimeout(function(){i.hasClass("dynamic")?o.remove():(i.prev("input[type=hidden]").val("1"),o.hide()),s.trigger("cocoon:after-remove",[o])},r)}),t(document).on("ready page:load",function(){t(".remove_fields.existing.destroyed").each(function(e,i){var n=t(this),o=n.data("wrapper-class")||"nested-fields";n.closest("."+o).hide()})})}(jQuery);